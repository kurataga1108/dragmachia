<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‰ãƒ©ã‚°ãƒã‚­ã‚¢ - ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #222; color: #fff; margin: 0; padding: 20px; }
        .battle-area { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .character { background: #333; padding: 15px; border-radius: 8px; width: 40%; }
        .hp-bar { background: #555; height: 20px; border-radius: 10px; margin-top: 10px; overflow: hidden;}
        .hp-fill { background: #4caf50; height: 100%; width: 100%; transition: width 0.3s; }
        .enemy-hp .hp-fill { background: #f44336; }
        
        /* ã‚³ãƒãƒ³ãƒ‰ãƒœã‚¿ãƒ³ã‚’ç¸¦ä¸¦ã³ã«ãã‚Œã„ã«é…ç½® */
        .command-area { display: flex; flex-direction: column; gap: 10px; align-items: center; }
        button { padding: 12px 20px; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; background: #2196f3; color: white; cursor: pointer; width: 100%; max-width: 300px; transition: 0.2s;}
        button:active { background: #1976d2; transform: scale(0.98); }
        /* CTä¸­ï¼ˆæŠ¼ã›ãªã„çŠ¶æ…‹ï¼‰ã®ãƒœã‚¿ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ */
        button:disabled { background: #555; color: #888; cursor: not-allowed; transform: none; }
        
        #log { margin-top: 20px; height: 150px; overflow-y: scroll; background: #111; padding: 10px; border-radius: 8px; text-align: left; font-size: 14px;}
    </style>
</head>
<body>

    <h1>ãƒ‰ãƒ©ã‚°ãƒã‚­ã‚¢</h1>

    <div class="battle-area">
        <div class="character">
            <h3>ãƒ¬ãƒƒãƒ‰ã‚¦ã‚£ãƒ³ã‚°</h3>
            <div id="player-hp-text">HP: 35 / 35</div>
            <div class="hp-bar"><div id="player-hp-fill" class="hp-fill"></div></div>
        </div>
        <div class="character">
            <h3>ãƒ—ãƒãƒ•ãƒ¬ã‚¢</h3>
            <div id="enemy-hp-text">HP: 30 / 30</div>
            <div class="hp-bar enemy-hp"><div id="enemy-hp-fill" class="hp-fill"></div></div>
        </div>
    </div>

    <div class="command-area">
        <button id="btn-skill-0" onclick="executeTurn(0)">ã²ã£ã‹ã</button>
        <button id="btn-skill-1" onclick="executeTurn(1)">ãƒ•ãƒ¬ã‚¤ãƒ ãƒ–ãƒ¬ã‚¹</button>
        <button id="btn-skill-2" onclick="executeTurn(2)">æ¸¾èº«ã®ä¸€æ’ƒ</button>
    </div>

    <div id="log">é‡ç”Ÿã®ãƒ—ãƒãƒ•ãƒ¬ã‚¢ãŒç¾ã‚ŒãŸï¼<br>ãƒãƒˆãƒ«é–‹å§‹ï¼<br></div>

    <script>
        // 1. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨ã€ŒæŠ€ï¼ˆã‚¹ã‚­ãƒ«ï¼‰ã€ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
        let player = { 
            name: "ãƒ¬ãƒƒãƒ‰ã‚¦ã‚£ãƒ³ã‚°", maxHp: 35, hp: 35, atk: 18, def: 10,
            skills: [
                { name: "ã²ã£ã‹ã", power: 1.0, maxCt: 0, currentCt: 0 },
                { name: "ãƒ•ãƒ¬ã‚¤ãƒ ãƒ–ãƒ¬ã‚¹", power: 1.5, maxCt: 3, currentCt: 0 },
                { name: "æ¸¾èº«ã®ä¸€æ’ƒ", power: 2.0, maxCt: 4, currentCt: 0 }
            ]
        };
        let enemy = { name: "ãƒ—ãƒãƒ•ãƒ¬ã‚¢", maxHp: 30, hp: 30, atk: 12, def: 8 };

        function addLog(message) {
            const logDiv = document.getElementById("log");
            logDiv.innerHTML += message + "<br>";
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // ç”»é¢ã®HPã¨ãƒœã‚¿ãƒ³ã®CTè¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹æ©Ÿèƒ½
        function updateUI() {
            document.getElementById("player-hp-text").innerText = `HP: ${player.hp} / ${player.maxHp}`;
            document.getElementById("player-hp-fill").style.width = `${(player.hp / player.maxHp) * 100}%`;
            
            document.getElementById("enemy-hp-text").innerText = `HP: ${enemy.hp} / ${enemy.maxHp}`;
            document.getElementById("enemy-hp-fill").style.width = `${(enemy.hp / enemy.maxHp) * 100}%`;

            // æŠ€ãƒœã‚¿ãƒ³ã®æ›´æ–°ï¼ˆCTãŒ0ã‚ˆã‚Šå¤§ãã„å ´åˆã¯æŠ¼ã›ãªãã—ã¦ã€æ®‹ã‚Šã‚¿ãƒ¼ãƒ³ã‚’è¡¨ç¤ºï¼‰
            for(let i = 0; i < 3; i++) {
                let btn = document.getElementById(`btn-skill-${i}`);
                let skill = player.skills[i];
                
                if(skill.currentCt > 0) {
                    btn.innerText = `${skill.name} (ã‚ã¨${skill.currentCt}ã‚¿ãƒ¼ãƒ³)`;
                    btn.disabled = true;
                } else {
                    btn.innerText = skill.name;
                    if(player.hp > 0 && enemy.hp > 0) {
                        btn.disabled = false; // HPãŒã‚ã‚‹æ™‚ã¯æŠ¼ã›ã‚‹ã‚ˆã†ã«æˆ»ã™
                    }
                }
            }
        }

        // 2. ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ï¼ˆæŠ€ã®å¨åŠ›å€ç‡ã‚’æ›ã‘ç®—ã«è¿½åŠ ï¼‰
        function calcDamage(atk, def, powerRatio) {
            let baseDamage = atk - (def / 2);
            let randomFactor = (Math.random() * 0.3) + 0.85; 
            let finalDamage = Math.floor(baseDamage * randomFactor * powerRatio);
            return Math.max(1, finalDamage);
        }

        // 3. æŠ€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®å‡¦ç†ï¼ˆå¼•æ•°ã§ã©ã®æŠ€ã‚’é¸ã‚“ã ã‹å—ã‘å–ã‚‹ï¼‰
        function executeTurn(skillIndex) {
            if (player.hp <= 0 || enemy.hp <= 0) return;

            let skill = player.skills[skillIndex];

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ”»æ’ƒ
            let pDamage = calcDamage(player.atk, enemy.def, skill.power);
            enemy.hp = Math.max(0, enemy.hp - pDamage);
            addLog(`â–¶ ${player.name}ã® ${skill.name}ï¼ ${enemy.name}ã« ${pDamage} ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
            
            // ä½¿ã£ãŸæŠ€ã®CTã‚’æœ€å¤§å€¤ã«ã‚»ãƒƒãƒˆã™ã‚‹
            skill.currentCt = skill.maxCt;
            updateUI();
            
            if (enemy.hp <= 0) {
                addLog(`â­ ${enemy.name}ã®æ´—è„³ãŒè§£ã‘ã€ä»²é–“ã«åŠ ã‚ã£ãŸï¼`);
                disableAllButtons();
                return;
            }

            // æ•µã®åæ’ƒä¸­ã¯ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ãªãã™ã‚‹
            disableAllButtons(); 
            
            setTimeout(() => {
                let eDamage = calcDamage(enemy.atk, player.def, 1.0); // æ•µã¯é€šå¸¸æ”»æ’ƒ
                player.hp = Math.max(0, player.hp - eDamage);
                addLog(`â–· ${enemy.name}ã®åæ’ƒï¼ ${player.name}ã« ${eDamage} ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
                
                // ã‚¿ãƒ¼ãƒ³çµ‚äº†æ™‚ï¼šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¨æŠ€ã®CTã‚’1æ¸›ã‚‰ã™
                for(let i=0; i<3; i++) {
                    if(player.skills[i].currentCt > 0) {
                        player.skills[i].currentCt--;
                    }
                }

                updateUI(); // CTæ¸›å°‘ã‚’ç”»é¢ã«åæ˜ ã—ã¦ãƒœã‚¿ãƒ³ã‚’å¾©æ´»ã•ã›ã‚‹
                
                if (player.hp <= 0) {
                    addLog(`ğŸ’€ ${player.name}ã¯å€’ã‚ŒãŸ...ç›®ã®å‰ãŒçœŸã£æš—ã«ãªã£ãŸã€‚`);
                    disableAllButtons();
                }
            }, 800); 
        }

        function disableAllButtons() {
            for(let i = 0; i < 3; i++) {
                document.getElementById(`btn-skill-${i}`).disabled = true;
            }
        }
    </script>
</body>
</html>
