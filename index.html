<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‰ãƒ©ã‚°ãƒã‚­ã‚¢ - ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #111; color: #fff; margin: 0; padding: 0; padding-bottom: 20px; }
        h1 { margin: 10px 0; font-size: 20px; color: #e91e63; }
        h2 { border-bottom: 2px solid #4caf50; padding-bottom: 5px; margin-bottom: 15px; color: #4caf50; }
        
        /* ç”»é¢åˆ‡ã‚Šæ›¿ãˆç”¨ */
        .screen { display: none; padding: 10px; max-width: 600px; margin: 0 auto; }
        .active-screen { display: block; }

        /* å…±é€šUIãƒ‘ãƒ¼ãƒ„ */
        .panel { background: #222; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        button { padding: 12px 20px; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; background: #2196f3; color: white; cursor: pointer; width: 100%; margin-bottom: 10px; transition: 0.2s; }
        button:active { transform: scale(0.98); background: #1976d2; }
        button:disabled { background: #555; color: #888; cursor: not-allowed; transform: none; }
        .btn-red { background: #f44336; } .btn-red:active { background: #d32f2f; }
        .btn-green { background: #4caf50; } .btn-green:active { background: #388e3c; }
        .btn-small { padding: 8px 12px; font-size: 12px; width: auto; margin: 0 5px; }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºï¼ˆãƒªã‚¹ãƒˆãƒ»ãƒãƒˆãƒ«å…±é€šï¼‰ */
        .char-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
        .character { background: #333; padding: 8px; border-radius: 8px; font-size: 12px; position: relative; border: 2px solid transparent; }
        .character h3 { margin: 3px 0; font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .hp-bar { background: #555; height: 10px; border-radius: 5px; margin-top: 5px; overflow: hidden;}
        .hp-fill { background: #4caf50; height: 100%; width: 100%; }
        .enemy-side .hp-fill { background: #f44336; }
        .dead { opacity: 0.5; filter: grayscale(100%); }
        .selected { border-color: #ffeb3b; background: #444; }

        /* åˆæˆç”»é¢ç”¨ */
        .fusion-slot { background: #222; padding: 15px; border-radius: 8px; border: 2px dashed #555; min-height: 80px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #666; }
        .fusion-arrow { font-size: 24px; margin: 10px 0; color: #ffeb3b; font-weight: bold; }

        /* ãƒãƒˆãƒ«ç”»é¢ç”¨èª¿æ•´ */
        .battle-party { display: flex; justify-content: space-around; gap: 5px; }
        .battle-char { width: 30%; }
        #log { height: 150px; overflow-y: scroll; background: #000; padding: 10px; border-radius: 8px; text-align: left; font-size: 12px; line-height: 1.4; margin-bottom: 10px; }
        .sys-text { color: #4fc3f7; font-weight: bold; border-top: 1px solid #333; margin-top: 5px; padding-top: 5px;}
        .dmg-text { color: #ff5252; } .heal-text { color: #4caf50; }
        .targeting { border-color: #ffeb3b; animation: pulse 0.8s infinite alternate; cursor: pointer; }
        @keyframes pulse { from { box-shadow: 0 0 5px #ffeb3b; } to { box-shadow: 0 0 15px #ffeb3b; } }
    </style>
</head>
<body>
    <h1>ãƒ‰ãƒ©ã‚°ãƒã‚­ã‚¢ãƒ»ãƒ—ãƒ­ãƒˆ</h1>

    <div id="home-screen" class="screen active-screen">
        <div class="panel">
            <h2>ç¾åœ¨ã®ãƒ‘ãƒ¼ãƒ†ã‚£</h2>
            <div id="home-party-list" class="char-list"></div>
        </div>
        <div style="margin-top: 20px;">
            <button class="btn-red" onclick="startQuest()">âš”ï¸ ã‚¯ã‚¨ã‚¹ãƒˆã«å‡ºç™º (ãƒãƒˆãƒ«)</button>
            <button class="btn-green" onclick="showScreen('fusion-screen'); updateFusionUI();">ğŸ§¬ ç«œåˆæˆãƒ©ãƒœã¸ (å¼·åŒ–)</button>
        </div>
    </div>

    <div id="fusion-screen" class="screen">
        <h2>ç«œåˆæˆãƒ©ãƒœ</h2>
        <div class="panel" style="background: #333;">
            <div>â–¼ ãƒ™ãƒ¼ã‚¹é¸æŠ (å¼·åŒ–ã—ãŸã„ç«œ) â–¼</div>
            <div id="base-slot" class="fusion-slot">é¸æŠã—ã¦ãã ã•ã„</div>
            <div class="fusion-arrow">ï¼‹</div>
            <div>â–¼ ç´ æé¸æŠ (æ¶ˆè²»ã™ã‚‹ç«œ) â–¼</div>
            <div id="material-slot" class="fusion-slot">é¸æŠã—ã¦ãã ã•ã„</div>
        </div>
        <button id="fusion-btn" disabled onclick="executeFusion()">åˆæˆå®Ÿè¡Œï¼ (HP+10, æ”»+2)</button>
        <button class="btn-red" onclick="showScreen('home-screen'); resetFusionSelection();">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>

        <div class="panel">
            <h3>æ‰€æŒãƒ‰ãƒ©ã‚´ãƒ³ä¸€è¦§</h3>
            <p style="font-size:12px; color:#aaa;">â€»ã‚¿ãƒƒãƒ—ã§é¸æŠã€‚ç´ æã«ã—ãŸç«œã¯æ¶ˆãˆã¾ã™ã€‚</p>
            <div id="fusion-list" class="char-list" style="grid-template-columns: repeat(4, 1fr);"></div>
        </div>
    </div>

    <div id="battle-screen" class="screen">
        <div class="panel" style="padding: 10px; background: #1a1a1a;">
            <div id="enemy-party-div" class="battle-party enemy-side"></div>
        </div>
        <div style="font-weight: bold; margin: 5px 0; font-size: 14px;">VS</div>
        <div class="panel" style="padding: 10px; background: #1a1a1a;">
            <div id="player-party-div" class="battle-party"></div>
        </div>
        
        <div id="log">ãƒãƒˆãƒ«ãƒ­ã‚°<br></div>

        <div id="command-area" class="panel">
            <div id="command-title" style="color: #4caf50; font-weight: bold; margin-bottom: 8px;">ã‚³ãƒãƒ³ãƒ‰</div>
            <div id="btn-group"></div>
        </div>
    </div>


    <script>
        // =========================================
        // ğŸ“Š ãƒ‡ãƒ¼ã‚¿ç®¡ç† (ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°)
        // =========================================
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰€æŒãƒ‰ãƒ©ã‚´ãƒ³ï¼ˆãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¡ãƒ³ãƒãƒ¼ï¼‰
        let myDragons = [
            { id: "p1", name: "ãƒ¬ãƒƒãƒ‰ã‚¦ã‚£ãƒ³ã‚°", maxHp: 50, hp: 50, atk: 20, def: 10, spd: 15, skills: [
                { name: "ã²ã£ã‹ã", type: "attack", target: "single_e", power: 1.0, ct: 0, maxCt: 0, acc: 1.0 },
                { name: "ãƒ•ãƒ¬ã‚¤ãƒ ãƒ–ãƒ¬ã‚¹", type: "attack", target: "all_e", power: 0.8, ct: 0, maxCt: 3, acc: 0.9 }
            ]},
            { id: "p2", name: "ã‚¢ã‚¯ã‚¢ã‚µãƒ¼ãƒšãƒ³ãƒˆ", maxHp: 45, hp: 45, atk: 8, def: 8, spd: 12, skills: [
                { name: "æ°´é‰„ç ²", type: "attack", target: "single_e", power: 1.2, ct: 0, maxCt: 0, acc: 1.0 },
                { name: "ç™’ã‚„ã—ã®æ³¢", type: "heal", target: "all_a", power: 1.5, ct: 0, maxCt: 4, acc: 1.0 }
            ]},
            { id: "p3", name: "ãƒªãƒ¼ãƒ•ãƒ­ãƒ³ã‚°", maxHp: 60, hp: 60, atk: 12, def: 15, spd: 8, skills: [
                { name: "ãŸã„ã‚ãŸã‚Š", type: "attack", target: "single_e", power: 1.0, ct: 0, maxCt: 0, acc: 1.0 },
                { name: "ãƒã‚¤ã‚ºãƒ³ãƒ–ãƒ¬ã‚¹", type: "attack", target: "single_e", power: 0.5, ct: 0, maxCt: 3, acc: 0.9, eff: "poison" }
            ]}
        ];
        // åˆæˆç´ æç”¨ã®æ§ãˆãƒ‰ãƒ©ã‚´ãƒ³ï¼ˆãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ï¼‰
        let materialDragons = [
            { id: "m1", name: "ãƒ—ãƒãƒ•ãƒ¬ã‚¢(ç´ æ)", maxHp: 20, hp: 20, atk: 5, def: 5, spd: 5 },
            { id: "m2", name: "ãƒ—ãƒã‚¢ã‚¯ã‚¢(ç´ æ)", maxHp: 20, hp: 20, atk: 5, def: 5, spd: 5 },
            { id: "m3", name: "ãƒ—ãƒãƒªãƒ¼ãƒ•(ç´ æ)", maxHp: 20, hp: 20, atk: 5, def: 5, spd: 5 }
        ];

        // ãƒãƒˆãƒ«ç”¨ã®ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿
        let battleState = { players: [], enemies: [], actions: [], turnIdx: 0, round: 1, targetingMode: null };
        // åˆæˆç”¨ã®ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿
        let fusionState = { baseId: null, materialId: null };

        // =========================================
        // ğŸ–¥ï¸ ç”»é¢é·ç§»ãƒ»å…±é€šå‡¦ç†
        // =========================================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById(screenId).classList.add('active-screen');
            if(screenId === 'home-screen') updateHomeUI();
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®HTMLã‚’ç”Ÿæˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function createCharHtml(char, isSmall = false) {
            let hpPer = (char.hp / char.maxHp) * 100;
            return `
                <div class="character ${isSmall ? 'battle-char' : ''} ${char.hp <= 0 ? 'dead' : ''}" id="char-${char.id}">
                    <h3>${char.name}</h3>
                    <div>HP: ${char.hp}/${char.maxHp} <small>(æ”»:${char.atk})</small></div>
                    <div class="hp-bar"><div class="hp-fill" style="width:${hpPer}%"></div></div>
                </div>`;
        }

        // =========================================
        // ğŸ  ãƒ›ãƒ¼ãƒ ç”»é¢ãƒ­ã‚¸ãƒƒã‚¯
        // =========================================
        function updateHomeUI() {
            let html = myDragons.map(d => createCharHtml(d)).join('');
            document.getElementById('home-party-list').innerHTML = html;
        }

        // =========================================
        // ğŸ§¬ åˆæˆç”»é¢ãƒ­ã‚¸ãƒƒã‚¯
        // =========================================
        function updateFusionUI() {
            let allDragons = [...myDragons, ...materialDragons];
            let html = allDragons.map(d => {
                let isSelected = (d.id === fusionState.baseId || d.id === fusionState.materialId);
                return `<div class="character ${isSelected ? 'selected' : ''}" onclick="selectFusionChar('${d.id}')">
                        <h3>${d.name}</h3>
                        <div style="font-size:10px;">HP:${d.maxHp} æ”»:${d.atk}</div>
                    </div>`;
            }).join('');
            document.getElementById('fusion-list').innerHTML = html;

            // ã‚¹ãƒ­ãƒƒãƒˆã®è¡¨ç¤ºæ›´æ–°
            let base = allDragons.find(d => d.id === fusionState.baseId);
            let material = allDragons.find(d => d.id === fusionState.materialId);
            document.getElementById('base-slot').innerHTML = base ? createCharHtml(base) : "é¸æŠã—ã¦ãã ã•ã„";
            document.getElementById('material-slot').innerHTML = material ? createCharHtml(material) : "é¸æŠã—ã¦ãã ã•ã„";
            document.getElementById('fusion-btn').disabled = !(base && material);
        }

        function selectFusionChar(id) {
            if (fusionState.baseId === null) {
                fusionState.baseId = id;
            } else if (fusionState.baseId === id) {
                fusionState.baseId = null; // é¸æŠè§£é™¤
            } else if (fusionState.materialId === id) {
                fusionState.materialId = null; // é¸æŠè§£é™¤
            } else {
                fusionState.materialId = id;
            }
            updateFusionUI();
        }

        function resetFusionSelection() {
            fusionState = { baseId: null, materialId: null };
        }

        function executeFusion() {
            let base = myDragons.find(d => d.id === fusionState.baseId);
            if (!base) return; // ãƒ™ãƒ¼ã‚¹ã¯ãƒ‘ãƒ¼ãƒ†ã‚£å†…ã‹ã‚‰ã®ã¿

            // å¼·åŒ–å‡¦ç†ï¼ˆç°¡æ˜“ç‰ˆï¼šHP+10, æ”»æ’ƒ+2ï¼‰
            base.maxHp += 10; base.hp = base.maxHp;
            base.atk += 2;
            alert(`åˆæˆæˆåŠŸï¼\n${base.name}ãŒå¼·åŒ–ã•ã‚Œã¾ã—ãŸï¼\n(æœ€å¤§HP+10, æ”»æ’ƒåŠ›+2)`);

            // ç´ æã‚’å‰Šé™¤
            myDragons = myDragons.filter(d => d.id !== fusionState.materialId);
            materialDragons = materialDragons.filter(d => d.id !== fusionState.materialId);

            resetFusionSelection();
            updateFusionUI();
        }

        // =========================================
        // âš”ï¸ ãƒãƒˆãƒ«ç”»é¢ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå‰å›ã®ã‚³ãƒ¼ãƒ‰ã‚’ç§»æ¤ãƒ»èª¿æ•´ï¼‰
        // =========================================
        function addLog(msg) {
            let log = document.getElementById('log');
            log.innerHTML += msg + "<br>"; log.scrollTop = log.scrollHeight;
        }

        function startQuest() {
            // ãƒãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–ï¼ˆãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼ã§å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·ï¼‰
            battleState.players = JSON.parse(JSON.stringify(myDragons));
            // æ•µãƒ‡ãƒ¼ã‚¿ï¼ˆæ¯å›ç”Ÿæˆï¼‰
            battleState.enemies = [
                { id: "e1", name: "ã‚¶ã‚³ãƒ•ãƒ¬ã‚¢A", maxHp: 30, hp: 30, atk: 10, def: 5, spd: 10, skills:[{name:"çªæ’ƒ",power:1.0,acc:1.0}] },
                { id: "e2", name: "ã‚¶ã‚³ãƒ•ãƒ¬ã‚¢B", maxHp: 30, hp: 30, atk: 10, def: 5, spd: 11, skills:[{name:"çªæ’ƒ",power:1.0,acc:1.0}] },
                { id: "e3", name: "ã‚¶ã‚³ãƒ•ãƒ¬ã‚¢C", maxHp: 30, hp: 30, atk: 10, def: 5, spd: 9, skills:[{name:"çªæ’ƒ",power:1.0,acc:1.0}] }
            ];
            battleState.round = 1; battleState.actions = []; battleState.turnIdx = 0;
            
            document.getElementById('log').innerHTML = "ã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹ï¼æ•µãŒç¾ã‚ŒãŸï¼<br>";
            showScreen('battle-screen');
            updateBattleUI();
            startCommandPhase();
        }

        function updateBattleUI() {
            document.getElementById('player-party-div').innerHTML = battleState.players.map(p => createCharHtml(p, true)).join('');
            document.getElementById('enemy-party-div').innerHTML = battleState.enemies.map(e => createCharHtml(e, true)).join('');
            
            // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠãƒ¢ãƒ¼ãƒ‰ã®è¡¨ç¤º
            if (battleState.targetingMode) {
                let targets = battleState.targetingMode.side === 'ally' ? battleState.players : battleState.enemies;
                targets.forEach(t => {
                    if(t.hp > 0) document.getElementById(`char-${t.id}`).classList.add('targeting');
                });
            }
        }

        // --- ã‚³ãƒãƒ³ãƒ‰å…¥åŠ› ---
        function startCommandPhase() {
            battleState.targetingMode = null;
            while(battleState.turnIdx < battleState.players.length && battleState.players[battleState.turnIdx].hp <= 0) {
                battleState.turnIdx++;
            }
            if(battleState.turnIdx >= battleState.players.length) {
                executeRoundPhase(); return;
            }
            
            let actor = battleState.players[battleState.turnIdx];
            document.getElementById('command-area').style.display = 'block';
            document.getElementById('command-title').innerText = `â–¼ ${actor.name} ã®è¡Œå‹•`;
            
            let html = actor.skills.map((s, idx) => `
                <button ${s.ct > 0 ? 'disabled' : ''} onclick="selectSkill(${idx})">
                    ${s.name} ${s.ct > 0 ? '(ã‚ã¨'+s.ct+')' : ''}
                </button>`).join('');
            document.getElementById('btn-group').innerHTML = html;
            updateBattleUI();
        }

        function selectSkill(idx) {
            let actor = battleState.players[battleState.turnIdx];
            let skill = actor.skills[idx];
            
            if(skill.target.includes('all')) {
                commitAction(actor, skill, null);
            } else {
                // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¸æŠã¸
                battleState.targetingMode = { skill: skill, side: skill.target.includes('_a') ? 'ally' : 'enemy' };
                document.getElementById('command-title').innerText = `å¯¾è±¡ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„`;
                document.getElementById('btn-group').innerHTML = `<button class="btn-red" onclick="startCommandPhase()">æˆ»ã‚‹</button>`;
                updateBattleUI();
                // ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š
                let targetGroup = battleState.targetingMode.side === 'ally' ? battleState.players : battleState.enemies;
                targetGroup.forEach(t => {
                    if(t.hp > 0) document.getElementById(`char-${t.id}`).onclick = () => commitAction(actor, skill, t);
                });
            }
        }

        function commitAction(actor, skill, target) {
            skill.ct = skill.maxCt;
            battleState.actions.push({ actor, skill, target });
            battleState.turnIdx++;
            startCommandPhase();
        }

        // --- ãƒãƒˆãƒ«å®Ÿè¡Œ ---
        function executeRoundPhase() {
            document.getElementById('command-area').style.display = 'none';
            addLog(`<div class="sys-text">ã€ROUND ${battleState.round}ã€‘</div>`);
            
            // æ•µã®è¡Œå‹•æ±ºå®šï¼ˆãƒ©ãƒ³ãƒ€ãƒ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼‰
            battleState.enemies.forEach(e => {
                if(e.hp > 0) {
                    let aliveP = battleState.players.filter(p => p.hp > 0);
                    if(aliveP.length > 0) {
                        battleState.actions.push({ actor: e, skill: e.skills[0], target: aliveP[Math.floor(Math.random()*aliveP.length)] });
                    }
                }
            });
            // é€Ÿåº¦é †ã‚½ãƒ¼ãƒˆ
            battleState.actions.sort((a, b) => b.actor.spd - a.actor.spd);
            
            let actIdx = 0;
            function processNextAction() {
                if(actIdx >= battleState.actions.length) { endRound(); return; }
                
                let act = battleState.actions[actIdx];
                actIdx++;
                if(act.actor.hp <= 0) { processNextAction(); return; } // è¡Œå‹•è€…ãŒæ­»ã‚“ã§ãŸã‚‰ã‚¹ã‚­ãƒƒãƒ—

                // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç”Ÿå­˜ç¢ºèªã¨å†å–å¾—
                let targets = [];
                if(act.skill.target.includes('all')) {
                    targets = (act.skill.target.includes('_a') ? battleState.players : battleState.enemies).filter(t => t.hp > 0);
                } else {
                    if(act.target.hp <= 0) { // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒæ­»ã‚“ã§ãŸã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«å¤‰æ›´
                        let group = act.skill.target.includes('_a') ? battleState.players : battleState.enemies;
                        let alive = group.filter(t => t.hp > 0);
                        if(alive.length === 0) { processNextAction(); return; }
                        act.target = alive[Math.floor(Math.random()*alive.length)];
                    }
                    targets = [act.target];
                }

                // æŠ€ã®å®Ÿè¡Œ
                let icon = battleState.players.includes(act.actor) ? "â–¶" : "â–·";
                targets.forEach(t => {
                    if(Math.random() > act.skill.acc) {
                        addLog(`${icon} ${act.actor.name}ã®${act.skill.name}ï¼...ãƒŸã‚¹ï¼`); return;
                    }
                    if(act.skill.type === 'heal') {
                        let heal = Math.floor(act.actor.atk * act.skill.power);
                        t.hp = Math.min(t.maxHp, t.hp + heal);
                        addLog(`${icon} ${act.actor.name}ã®${act.skill.name}ï¼<span class="heal-text">${t.name}ãŒ${heal}å›å¾©ï¼</span>`);
                    } else {
                        let dmg = Math.floor(Math.max(1, (act.actor.atk - t.def/2) * act.skill.power * (Math.random()*0.4+0.8)));
                        t.hp = Math.max(0, t.hp - dmg);
                        addLog(`${icon} ${act.actor.name}ã®${act.skill.name}ï¼<span class="dmg-text">${t.name}ã«${dmg}ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼</span>`);
                    }
                });
                updateBattleUI();
                
                // å‹æ•—åˆ¤å®š
                if(battleState.players.every(p => p.hp <= 0)) { finishBattle(false); return; }
                if(battleState.enemies.every(e => e.hp <= 0)) { finishBattle(true); return; }

                setTimeout(processNextAction, 800);
            }
            processNextAction();
        }

        function endRound() {
            // CTæ¸›å°‘
            [...battleState.players, ...battleState.enemies].forEach(c => {
                if(c.skills) c.skills.forEach(s => { if(s.ct > 0) s.ct--; });
            });
            battleState.round++;
            battleState.actions = [];
            battleState.turnIdx = 0;
            setTimeout(startCommandPhase, 1000);
        }

        function finishBattle(isWin) {
            addLog(`<div class="sys-text" style="font-size:16px; padding:10px;">${isWin ? "ğŸ‰ ã‚¯ã‚¨ã‚¹ãƒˆã‚¯ãƒªã‚¢ï¼å‹åˆ©ï¼" : "ğŸ’€ å…¨æ»…ã—ãŸ...æ•—åŒ—..."}</div>`);
            document.getElementById('command-area').innerHTML = `<button class="btn-green" onclick="showScreen('home-screen')">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>`;
            document.getElementById('command-area').style.display = 'block';
            
            // ãƒãƒˆãƒ«çµ‚äº†å¾Œã®HPã‚’åæ˜ ã•ã›ã‚‹ï¼ˆå›å¾©ã—ãŸHPãªã©ã‚’ä¿æŒï¼‰
            if(isWin) {
                myDragons.forEach(d => {
                    let battleData = battleState.players.find(bd => bd.id === d.id);
                    if(battleData) d.hp = battleData.hp;
                });
            } else {
                // è² ã‘ãŸå ´åˆã¯HP1ã§å¾©æ´»
                myDragons.forEach(d => d.hp = 1);
            }
            updateHomeUI(); // ãƒ›ãƒ¼ãƒ ã®è¡¨ç¤ºã‚’æ›´æ–°ã—ã¦ãŠã
        }

        // åˆå›èµ·å‹•æ™‚
        updateHomeUI();

    </script>
</body>
</html>
