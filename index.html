<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‰ãƒ©ã‚°ãƒã‚­ã‚¢ - ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #222; color: #fff; margin: 0; padding: 20px; }
        .battle-area { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .character { background: #333; padding: 15px; border-radius: 8px; width: 40%; }
        .hp-bar { background: #555; height: 20px; border-radius: 10px; margin-top: 10px; overflow: hidden;}
        .hp-fill { background: #4caf50; height: 100%; width: 100%; transition: width 0.3s; }
        .enemy-hp .hp-fill { background: #f44336; }
        button { padding: 15px 30px; font-size: 18px; font-weight: bold; border: none; border-radius: 8px; background: #2196f3; color: white; cursor: pointer; width: 100%; max-width: 300px;}
        button:active { background: #1976d2; }
        #log { margin-top: 20px; height: 150px; overflow-y: scroll; background: #111; padding: 10px; border-radius: 8px; text-align: left; font-size: 14px;}
    </style>
</head>
<body>

    <h1>ãƒ‰ãƒ©ã‚°ãƒã‚­ã‚¢</h1>

    <div class="battle-area">
        <div class="character">
            <h3>ãƒ¬ãƒƒãƒ‰ã‚¦ã‚£ãƒ³ã‚°</h3>
            <div id="player-hp-text">HP: 35 / 35</div>
            <div class="hp-bar"><div id="player-hp-fill" class="hp-fill"></div></div>
        </div>
        <div class="character">
            <h3>ãƒ—ãƒãƒ•ãƒ¬ã‚¢</h3>
            <div id="enemy-hp-text">HP: 25 / 25</div>
            <div class="hp-bar enemy-hp"><div id="enemy-hp-fill" class="hp-fill"></div></div>
        </div>
    </div>

    <button id="attack-btn" onclick="executeTurn()">ãŸãŸã‹ã†ï¼ˆé€šå¸¸æ”»æ’ƒï¼‰</button>

    <div id="log">é‡ç”Ÿã®ãƒ—ãƒãƒ•ãƒ¬ã‚¢ãŒç¾ã‚ŒãŸï¼<br>ãƒãƒˆãƒ«é–‹å§‹ï¼<br></div>

    <script>
        // 1. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
        let player = { name: "ãƒ¬ãƒƒãƒ‰ã‚¦ã‚£ãƒ³ã‚°", maxHp: 35, hp: 35, atk: 18, def: 10 };
        let enemy = { name: "ãƒ—ãƒãƒ•ãƒ¬ã‚¢", maxHp: 25, hp: 25, atk: 12, def: 8 };

        // ãƒãƒˆãƒ«ãƒ­ã‚°ã‚’è¿½åŠ ã™ã‚‹æ©Ÿèƒ½
        function addLog(message) {
            const logDiv = document.getElementById("log");
            logDiv.innerHTML += message + "<br>";
            logDiv.scrollTop = logDiv.scrollHeight; // å¸¸ã«æœ€æ–°ã®ãƒ­ã‚°ã‚’ä¸‹ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        }

        // ç”»é¢ã®HPè¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹æ©Ÿèƒ½
        function updateUI() {
            document.getElementById("player-hp-text").innerText = `HP: ${player.hp} / ${player.maxHp}`;
            document.getElementById("player-hp-fill").style.width = `${(player.hp / player.maxHp) * 100}%`;
            
            document.getElementById("enemy-hp-text").innerText = `HP: ${enemy.hp} / ${enemy.maxHp}`;
            document.getElementById("enemy-hp-fill").style.width = `${(enemy.hp / enemy.maxHp) * 100}%`;
        }

        // 2. ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ã®ãƒ«ãƒ¼ãƒ«ï¼ˆä¹±æ•° 85%ã€œ115%ï¼‰
        function calcDamage(atk, def) {
            let baseDamage = atk - (def / 2);
            let randomFactor = (Math.random() * 0.3) + 0.85; 
            let finalDamage = Math.floor(baseDamage * randomFactor);
            return Math.max(1, finalDamage); // æœ€ä½ã§ã‚‚1ãƒ€ãƒ¡ãƒ¼ã‚¸ã¯ä¸ãˆã‚‹
        }

        // 3. ãŸãŸã‹ã†ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®å‡¦ç†
        function executeTurn() {
            if (player.hp <= 0 || enemy.hp <= 0) return; // ã©ã¡ã‚‰ã‹ãŒå€’ã‚Œã¦ã„ãŸã‚‰ã‚¹ãƒˆãƒƒãƒ—

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ”»æ’ƒ
            let pDamage = calcDamage(player.atk, enemy.def);
            enemy.hp = Math.max(0, enemy.hp - pDamage);
            addLog(`â–¶ ${player.name}ã®æ”»æ’ƒï¼ ${enemy.name}ã« ${pDamage} ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
            updateUI();
            
            if (enemy.hp <= 0) {
                addLog(`â­ ${enemy.name}ã®æ´—è„³ãŒè§£ã‘ã€ä»²é–“ã«åŠ ã‚ã£ãŸï¼`);
                document.getElementById("attack-btn").disabled = true;
                return;
            }

            // æ•µã®åæ’ƒï¼ˆå°‘ã—é…ã‚‰ã›ã¦æ¼”å‡ºã£ã½ãã™ã‚‹ï¼‰
            setTimeout(() => {
                let eDamage = calcDamage(enemy.atk, player.def);
                player.hp = Math.max(0, player.hp - eDamage);
                addLog(`â–· ${enemy.name}ã®åæ’ƒï¼ ${player.name}ã« ${eDamage} ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
                updateUI();
                
                if (player.hp <= 0) {
                    addLog(`ğŸ’€ ${player.name}ã¯å€’ã‚ŒãŸ...ç›®ã®å‰ãŒçœŸã£æš—ã«ãªã£ãŸã€‚`);
                    document.getElementById("attack-btn").disabled = true;
                }
            }, 800); 
        }
    </script>
</body>
</html>
